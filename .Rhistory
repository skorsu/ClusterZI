test_dat <- data_sim(N = 100, K = 3, J = 1000, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.5, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
test_dat$w
result <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = c(1, rep(0, 999)),
gamma_mat = test_dat$gamma, xi = exp(test_dat$beta), b0w = 10, b1w = 1,
iter_w = 20, trh = 0.5)
which(apply(result, 2, mean) >= 0.5)
test_dat <- data_sim(N = 100, K = 3, J = 1000, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.5, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
test_dat$w
result <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = c(1, rep(0, 999)),
gamma_mat = test_dat$gamma, xi = exp(test_dat$beta), b0w = 10, b1w = 1,
iter_w = 20, trh = 0.5)
which(apply(result, 2, mean) >= 0.5)
test_dat <- data_sim(N = 100, K = 3, J = 1000, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.5, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
test_dat$w
result <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = c(1, rep(0, 999)),
gamma_mat = test_dat$gamma, xi = exp(test_dat$beta), b0w = 10, b1w = 1,
iter_w = 20, trh = 0.5)
which(apply(result, 2, mean) >= 0.5)
result <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = c(1, rep(0, 999)),
gamma_mat = test_dat$gamma, xi = exp(test_dat$beta), b0w = 10, b1w = 1,
iter_w = 20, trh = 0.5)
result
apply(result, 2, mean)
Rcpp::sourceCpp("src/clusterZI.cpp")
set.seed(12)
test_dat <- data_sim(N = 100, K = 3, J = 1000, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.5, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
exp(test_dat$beta)
log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci, b0w = 1, b1w = 1)
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci, b0w = 1, b1w = 1)
test
exp(test_dat$beta) == test
identical(exp(test_dat$beta), test)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci, b0w = 1, b1w = 1)
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
test
matrix(rep(w, 100), ncol = 1000)
matrix(rep(test_dat$ww, 100), ncol = 1000)
matrix(rep(test_dat$w, 100), ncol = 1000)
test_dat$beta
test_dat$beta[test_dat$ci, ]
matrix(rep(test_dat$w, 100), ncol = 1000) * test_dat$beta[test_dat$ci, ]
test_dat$gamma * matrix(rep(test_dat$w, 100), ncol = 1000) * test_dat$beta[test_dat$ci, ]
identical(test_dat$gamma * matrix(rep(test_dat$w, 100), ncol = 1000) * test_dat$beta[test_dat$ci, ], test)
test_dat$gamma * matrix(rep(test_dat$w, 100), ncol = 1000) * test_dat$beta[test_dat$ci, ]
(test_dat$gamma * matrix(rep(test_dat$w, 100), ncol = 1000) * test_dat$beta[test_dat$ci, ])[1, ]
test[1, ]
(test_dat$gamma * matrix(rep(test_dat$w, 100), ncol = 1000) * exp(test_dat$beta[test_dat$ci, ]))[1, ]
test[1, ]
test_dat$gamma
matrix(rep(test_dat$w, 100), ncol = 1000)
(test_dat$gamma * matrix(rep(test_dat$w, 100), ncol = 1000) * exp(test_dat$beta[test_dat$ci, ]))[1, ]
test[1, ]
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
test
set.seed(12)
test_dat <- data_sim(N = 10, K = 3, J = 5, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.5, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
set.seed(125)
test_dat <- data_sim(N = 10, K = 3, J = 5, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.5, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
set.seed(12)
test_dat <- data_sim(N = 10, K = 3, J = 5, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.25, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
set.seed(12)
test_dat <- data_sim(N = 10, K = 3, J = 30, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.25, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
test_dat
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
test
matrix(rep(test_dat$w, 10), ncol = 30)
matrix(rep(test_dat$w, 10), ncol = 30) %>% t()
matrix(rep(test_dat$w, 10), nrow = 30) %>% t()
Rcpp::sourceCpp("src/clusterZI.cpp")
set.seed(12)
test_dat <- data_sim(N = 10, K = 3, J = 30, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.25, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
(test_dat$gamma * (matrix(rep(test_dat$w, 10), nrow = 30) %>% t()) * exp(test_dat$beta[test_dat$ci, ]))[1, ]
test[1, ]
identical((test_dat$gamma * (matrix(rep(test_dat$w, 10), nrow = 30) %>% t()) * exp(test_dat$beta[test_dat$ci, ])), test)
Rcpp::sourceCpp("src/clusterZI.cpp")
test_dat$w
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
beta(2, 1)
log(beta(2, 1))
std::cout << arma::sum(gwx, 1) << std::endl;
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
gwz <- (test_dat$gamma * (matrix(rep(test_dat$w, 10), nrow = 30) %>% t()) * exp(test_dat$beta[test_dat$ci, ]))
gwz
gwz[, 1]
z[, 1]
test_dat$z[, 1]
(gwz[, 1] + test_dat$z[, 1]) != 0
(gwz[, 1] + test_dat$z[, 1])[(gwz[, 1] + test_dat$z[, 1]) != 0]
sum(lgamma((gwz[, 1] + test_dat$z[, 1])[(gwz[, 1] + test_dat$z[, 1]) != 0]))
sum(lgamma(gwz[, 1][gwz[, 1] != 0]))
rowSums(gwz)
lgamma(rowSums(gwz))
sum(lgamma(rowSums(gwz)))
sum(lgamma(rowSums(test_dat$z + gwz)))
test_dat$w
log(beta(2, 1)) +
sum(lgamma((gwz[, 1] + test_dat$z[, 1])[(gwz[, 1] + test_dat$z[, 1]) != 0])) -
sum(lgamma(gwz[, 1][gwz[, 1] != 0]))
log(beta(2, 1)) +
sum(lgamma((gwz[, 1] + test_dat$z[, 1])[(gwz[, 1] + test_dat$z[, 1]) != 0])) -
sum(lgamma(gwz[, 1][gwz[, 1] != 0])) +
sum(lgamma(rowSums(gwz))) -
sum(lgamma(rowSums(test_dat$z + gwz)))
log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
set.seed(12)
test_dat <- data_sim(N = 1000, K = 3, J = 30, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.25, s2 = 1, lb_a = 10, ub_a = 20, lb_ia = 5, ub_ia = 10)
test_dat$z
set.seed(12)
test_dat <- data_sim(N = 1000, K = 3, J = 500, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.65, s2 = 1, lb_a = 500, ub_a = 1000, lb_ia = 250, ub_ia = 350)
test_dat$z
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
test
exp(test)
test
test_dat$z
test_dat$z[, 1]
cbind(test_dat$z[, 1], test_dat$w)
new_w <- test_dat$w
test_dat$w
new_w[1] <- 0
test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = test_dat$w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
new_w <- test_dat$w
new_w[1] <- 0
new_test <- log_wj(j = 0, z = test_dat$z, gamma_mat = test_dat$gamma, w = new_w,
beta = test_dat$beta, clus_assign = test_dat$ci - 1, b0w = 1, b1w = 1)
new_test
new_test - test
test
exp(new_test - test)
Rcpp::sourceCpp("src/clusterZI.cpp")
update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, xi = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, xi = test_dat$beta, b0w = 1, b1w = 1)
set.seed(12)
test_dat <- data_sim(N = 100, K = 3, J = 40, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.65, s2 = 1, lb_a = 500, ub_a = 1000, lb_ia = 250, ub_ia = 350)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, xi = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, xi = test_dat$beta, b0w = 1, b1w = 1)
update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, xi = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, xi = test_dat$beta, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(1, 50),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(1, 50),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(0, 50),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(0, 50),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(0, 50),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(0, 50),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(0, 50),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(1, 50),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(1, 50),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci, old_w = rep(1, 40),
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test_dat$z
test_dat$ci
rep(1, 40)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$ci,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
test <- update_w(z = test_dat$z, clus_assign = test_dat$ci - 1, old_w = test_dat$w,
gamma_mat = test_dat$gamma, beta = test_dat$beta, b0w = 1, b1w = 1)
table(test, test_dat$w)
Rcpp::sourceCpp("src/clusterZI.cpp")
library(tidyverse)
### Data Simulation
data_sim <- function(N, K, J, clus_prop, pi_g, pi_w, s2, lb_a, ub_a, lb_ia, ub_ia){
### cluster assignment
ci <- sample(1:K, N, replace = TRUE, prob = clus_prop)
### gamma for each observation based on its cluster (at-risk indicator)
gm_mat <- t(apply(matrix(pi_g[ci]), 1, rbinom, n = J, size = 1))
### w (important variable)
w <- sort(rbinom(J, 1, pi_w), decreasing = TRUE)
n_active <- sum(w)
### Generate xi = exp(beta) where beta ~ N(0, s2).
beta <- matrix(rnorm(J * K, 0, sqrt(s2)), ncol = J)
xi <- exp(beta)
### Generate the data separately for active and inactive cluster
alpha_mat <- matrix(rgamma(K * J, xi, 1), ncol = J)
### active variable
active_alpha <- alpha_mat[ci, (1:n_active)]
gm_alpha_active <- gm_mat[, (1:n_active)] * active_alpha
alpha_norm_active <- t(apply(gm_alpha_active, 1, function(x){x/sum(x)}))
sum_zi_active <- round(runif(N, lb_a, ub_a))
zi_active <- matrix(NA, ncol = n_active, nrow = N)
for(i in 1:N){
zi_active[i, ] <- rmultinom(1, sum_zi_active[i], alpha_norm_active[i, ])
}
### inactive variable
inactive_alpha <- alpha_mat[ci, (n_active+1):J]
gm_alpha_inactive <- gm_mat[, (n_active+1):J] * inactive_alpha
alpha_norm_inactive <- t(apply(gm_alpha_inactive, 1, function(x){x/sum(x)}))
sum_zi_inactive <- round(runif(N, lb_ia, ub_ia))
zi_inactive <- matrix(NA, ncol = J - n_active, nrow = N)
for(i in 1:N){
zi_inactive[i, ] <- rmultinom(1, sum_zi_inactive[i], alpha_norm_inactive[i, ])
}
zi <- cbind(zi_active, zi_inactive)
### Rearrange the variable order
variable_order <- sample(1:J, J)
gm_mat <- gm_mat[, variable_order]
w <- w[variable_order]
beta <- beta[, variable_order]
zi <- zi[, variable_order]
### Return the simulated data
list(ci = ci, gamma = gm_mat, w = w, beta = beta, z = zi)
}
set.seed(12)
test_dat <- data_sim(N = 100, K = 3, J = 40, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.65, s2 = 1, lb_a = 500, ub_a = 1000, lb_ia = 250, ub_ia = 350)
test_dat
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
clus_assign = test_dat$ci, s2 = 1)
test_bet
test_bet
test_dat$beta[1, 1]
dnorm(test_dat$beta[1, 1], 0, 1)
log(dnorm(test_dat$beta[1, 1], 0, 1))
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
clus_assign = test_dat$ci, s2 = 10)
test_bet
log(dnorm(test_dat$beta[1, 1], 0, 10))
log(dnorm(test_dat$beta[1, 1], 0, sqrt(10)))
test_dat$ci
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
clus_assign = test_dat$ci, s2 = 10)
test_bet
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci, s2 = 10)
test_dat$w
set.seed(12)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.65, s2 = 1, lb_a = 50, ub_a = 100, lb_ia = 25, ub_ia = 35)
set.seed(12)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.35, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
set.seed(12)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
set.seed(12)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat <- data_sim(N = 100, K = 3, J = 20, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
set.seed(12)
test_dat <- data_sim(N = 100, K = 3, J = 50, clus_prop = c(0.3, 0.4, 0.3),
pi_g = c(0.75, 0.9, 0.5), pi_w = 0.15, s2 = 1, lb_a = 20, ub_a = 30, lb_ia = 25, ub_ia = 35)
test_dat$w
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci, s2 = 10)
test_dat$ci
table(test_dat$ci)
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
test_dat$ci - 1
table(test_dat$ci - 1)
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_jk(beta_jk = test_dat$beta[1, 1], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_k(beta_jk = test_dat$beta, ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
test_bet <- log_beta_k(beta_k = test_dat$beta, ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
test_bet <- log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
test_dat$beta[1, ]
Rcpp::sourceCpp("src/clusterZI.cpp")
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
log(dnorm(test_dat$beta[1, ], 0, sqrt(10)))
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
test_bet
test_dat$w == 1
log(dnorm(test_dat$beta[1, test_dat$w == 1], 0, sqrt(10)))
identical(test_bet, log(dnorm(test_dat$beta[1, test_dat$w == 1], 0, sqrt(10))))
cbind(test_bet, log(dnorm(test_dat$beta[1, test_dat$w == 1], 0, sqrt(10))))
cbind(round(test_bet, 5), round(log(dnorm(test_dat$beta[1, test_dat$w == 1], 0, sqrt(10))), 5))
identical(round(test_bet, 5), round(log(dnorm(test_dat$beta[1, test_dat$w == 1], 0, sqrt(10))), 5))
identical(round(test_bet, 1), round(log(dnorm(test_dat$beta[1, test_dat$w == 1], 0, sqrt(10))), 1))
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
test_bet
Rcpp::sourceCpp("src/clusterZI.cpp")
test_bet <- log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
test_bet
lgamma(1)
lgamma(0)
Rcpp::sourceCpp("src/clusterZI.cpp")
log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
Rcpp::sourceCpp("src/clusterZI.cpp")
log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
Rcpp::sourceCpp("src/clusterZI.cpp")
log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
Rcpp::sourceCpp("src/clusterZI.cpp")
log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
test_bet <- log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 10)
test_bet <- log_beta_k(beta_k = test_dat$beta[1, ], ci = 2 - 1, z = test_dat$z,
gamma_mat = test_dat$gamma, beta = test_dat$beta,
w = test_dat$w, clus_assign = test_dat$ci - 1, s2 = 1)
test_bet
